name: Inventory Crisis Response
description: Handle low inventory alert and coordinate restocking with marketing
complexity: high
version: "1.0"

agents:
  - id: product-agent
    type: product_upload
  - id: marketing-agent
    type: marketing

steps:
  - name: detect_low_inventory
    agent: product-agent
    action: detect
    expected_status: alert_triggered
    timeout_seconds: 10
    term_conflicts:
      terms: ["inventory_level", "stock_count", "available_units"]
      probability: 0.30
      severity: medium
    
  - name: assess_impact
    agent: product-agent
    action: analyze
    expected_status: impact_assessed
    timeout_seconds: 30
    config:
      check_pending_orders: true
      estimate_stockout_date: true
    term_conflicts:
      terms: ["stockout_date", "depletion_date", "oos_estimate"]
      probability: 0.40
      severity: high
    
  - name: update_listing_availability
    agent: product-agent
    action: update
    expected_status: availability_updated
    timeout_seconds: 20
    config:
      show_low_stock_warning: true
      limit_quantity: true
    term_conflicts:
      terms: ["availability_status", "stock_status", "inventory_state"]
      probability: 0.35
      severity: high
    
  - name: notify_marketing_urgent
    agent: product-agent
    action: handoff
    expected_status: handoff_complete
    target_agent: marketing-agent
    timeout_seconds: 5
    config:
      priority: urgent
    term_conflicts:
      terms: ["urgency_level", "priority_score", "alert_severity"]
      probability: 0.45
      severity: high
    
  - name: pause_active_campaigns
    agent: marketing-agent
    action: pause_campaigns
    expected_status: campaigns_paused
    timeout_seconds: 30
    term_conflicts:
      terms: ["campaign_status", "ad_state"]
      probability: 0.25
      severity: medium
    
  - name: create_restock_notification
    agent: marketing-agent
    action: create_notification
    expected_status: notification_created
    timeout_seconds: 45
    config:
      notification_type: restock_alert
      channels: [email, push]
    term_conflicts:
      terms: ["notification_template", "message_format"]
      probability: 0.30
      severity: medium
    
  - name: schedule_restock_campaign
    agent: marketing-agent
    action: schedule
    expected_status: scheduled
    timeout_seconds: 30
    config:
      trigger: on_restock
      campaign_type: back_in_stock
    term_conflicts:
      terms: ["restock_date", "replenishment_date", "arrival_date"]
      probability: 0.35
      severity: medium

failure_injection:
  enabled: true
  probability: 0.35
  target_steps: [2, 3, 4, 5]
  failure_types:
    - crash
    - timeout
    - message_corruption

initial_state:
  task_id: "inventory-crisis-{{run_id}}"
  inventory_data:
    product_id: "prod-critical-001"
    current_stock: 5
    threshold: 10
    daily_sales_avg: 8
    pending_orders: 3
    reorder_lead_time_days: 7

success_criteria:
  final_status: scheduled
  all_steps_executed: true
  campaigns_paused: true
  customers_notified: true

